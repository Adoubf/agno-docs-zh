---
title: Storage
---

Agents come with built-in memory but it only lasts while the session is active. To continue conversations across sessions, we store Agent sessions in a database like PostgreSQL.

Storage is a necessary component when building user facing AI products as any production application will require users to be able to "continue" their conversation with the Agent.

The general syntax for adding storage to an Agent looks like:

```python
from phi.agent import Agent
from phi.model.openai import OpenAIChat
from phi.tools.duckduckgo import DuckDuckGo
from phi.storage.agent.postgres import PgAgentStorage

agent = Agent(
    model=OpenAIChat(id="gpt-4o"),
    storage=PgAgentStorage(table_name="agent_sessions", db_url="postgresql+psycopg://ai:ai@localhost:5532/ai"),
    tools=[DuckDuckGo()],
    show_tool_calls=True,
    add_history_to_messages=True,
)
agent.print_response("How many people live in Canada?")
agent.print_response("What is their national anthem called?")
agent.print_response("Which country are we speaking about?")
```

## Example

<Steps>
  <Step title="Run Postgres">

    Install [docker desktop](https://docs.docker.com/desktop/install/mac-install/) and run **Postgres** on port **5532** using:

    ```bash
    docker run -d \
      -e POSTGRES_DB=ai \
      -e POSTGRES_USER=ai \
      -e POSTGRES_PASSWORD=ai \
      -e PGDATA=/var/lib/postgresql/data/pgdata \
      -v pgvolume:/var/lib/postgresql/data \
      -p 5532:5432 \
      --name pgvector \
      phidata/pgvector:16
    ```

  </Step>
  <Step title="Create an Agent with Storage">
    Create a file `agent_with_storage.py` with the following contents

    ```python
    import typer
    from rich.prompt import Prompt
    from typing import Optional, List
    from phi.agent import Agent
    from phi.storage.agent.postgres import PgAgentStorage
    from phi.knowledge.pdf import PDFUrlKnowledgeBase
    from phi.vectordb.pgvector import PgVector

    db_url = "postgresql+psycopg://ai:ai@localhost:5532/ai"

    knowledge_base = PDFUrlKnowledgeBase(
        urls=["https://phi-public.s3.amazonaws.com/recipes/ThaiRecipes.pdf"],
        vector_db=PgVector(table_name="recipes", db_url=db_url),
    )
    # Comment out after first run
    knowledge_base.load()

    storage = PgAgentStorage(table_name="pdf_agent", db_url=db_url)


    def pdf_agent(new: bool = False, user: str = "user"):
        run_id: Optional[str] = None

        if not new:
            existing_run_ids: List[str] = storage.get_all_run_ids(user)
            if len(existing_run_ids) > 0:
                run_id = existing_run_ids[0]

        agent = Agent(
            run_id=run_id,
            user_id=user,
            knowledge_base=knowledge_base,
            storage=storage,
            # Show tool calls in the response
            show_tool_calls=True,
            # Enable the agent to search the knowledge base
            search_knowledge=True,
            # Enable the agent to read the chat history
            read_chat_history=True,
        )
        if run_id is None:
            run_id = agent.run_id
            print(f"Started Run: {run_id}\n")
        else:
            print(f"Continuing Run: {run_id}\n")

        # Runs the agent as a cli app
        agent.cli_app(markdown=True)


    if __name__ == "__main__":
        typer.run(pdf_agent)
    ```

  </Step>
  <Step title="Run the agent">
    Install libraries

    <CodeGroup>

    ```bash Mac
    pip install -U phidata openai pgvector pypdf "psycopg[binary]" sqlalchemy
    ```

    ```bash Windows
    pip install -U phidata openai pgvector pypdf "psycopg[binary]" sqlalchemy
    ```

    </CodeGroup>

    Run the agent

    ```bash
    python agent_with_storage.py
    ```

    Now the agent continues across sessions. Ask a question:

    ```
    How do I make pad thai?
    ```

    Then message `bye` to exit, start the app again and ask:

    ```
    What was my last message?
    ```

  </Step>
  <Step title="Start a new run">
    Run the `agent_with_storage.py` file with the `--new` flag to start a new run.

    ```bash
    python agent_with_storage.py --new
    ```

  </Step>
</Steps>

## Params

<ResponseField name="storage" type="Optional[AgentStorage]" default="None">
  Storage mechanism for the agent, if applicable.
</ResponseField>
